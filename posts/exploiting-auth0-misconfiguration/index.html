<!DOCTYPE html>
<html lang="en">
<style type="text/css">
  ul li strong {
    margin-left: 20px;
  }
  .navigation-title h3 {
       
      font-weight: bold;
      padding-right: 5px;
      width: fit-content;
      font-family: Arial, Helvetica, sans-serif;
      position: relative;
      overflow: hidden;
      padding-right: 5px;
      white-space: nowrap;
      margin: 0;
      color: red !important;
      border-right: 4px solid white;
      transition: 0.5s;
      animation-direction: alternate;
      display: inline-block !important;
       
      animation:  sd 1s linear infinite;

  }
  @keyframes sd {
    from {
      border-right-color: white;
    }
    to {
      border-right-color: transparent;
    }
  }
  @keyframes wewe {
    from {
      width: 0px ;
    }
    to {
      width: 118px ;
    }
  }

  table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }
  
  td, th {
    border: 1px solid;
    padding: 8px;
  }
  strong{
    margin: 0 !important;
  }
    .code-style {
      background-color: #1a1d1e !important;
      color: rgb(213, 209, 203) !important;
    }
</style>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Kareem ALsadeq">
<meta name="keywords" content="blog,pentester,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Kareem Alsadeq&#39;s personal website"/>

<meta property="og:title" content="" />
<meta property="og:description" content="Kareem Alsadeq&#39;s personal website" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://kareemelsadek.github.io/notes/fileupload/" />




  <title>ALsadeq</title>

  
  <link rel="canonical" href="https://kareemelsadek.github.io/notes/fileupload/">
  

  <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0">


  
  
  <link rel="stylesheet" href="/css/coder.min.d0d974af9060db1f638bc87d1142862c434e0df7c8f2272ef0e8ed5590cef186.css">





  
  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.01ce5a59759539162fb20573a28d9572f4f718f648ae0c0cb12d0b09bea975bc.css">
  

    <link rel="stylesheet" href="/css/prism.css">


      <meta property="og:image" content="/sqlmap.png" />
      <meta property="og:type" content="website" />
      <meta property="og:url" content="https://kareemelsadek.github.io/posts/tamper"/>
      <meta property="og:title" content="Write your custom Tamper Script" />
      <meta property="og:description" content="SqlMap Tamper Script"/>	
 




  <link rel="icon" type="image/png" href="/favicon-32x32.png">
<link rel="icon" type="image/png" href="/favicon-16x16.png">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg">


  <link rel="alternate" type="application/rss+xml" href="/notes/fileupload/index.xml">


  <meta name="generator" content="Hugo 0.101.0" />


  

</head>






<head>
  <title>test</title>
</head>
<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      <h3>
      ALsadeq
    </h3>
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blogs</a>
            </li>
          
            <li class="navigation-item">
               <a class="navigation-link" href="/notes/" style="pointer-events: none">Notes</a>
            </li>
            
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>

<script src="/js/prism.js"></script>

<div class="content">
    <section class="container ">
        <h1>Exploiting Auth0 Misconfiguration: A Case Study on Account Linking Vulnerabilities</h1>

<p>During our comprehensive testing of the application, with my talented friend <a target="_blank" href="https://www.linkedin.com/in/iknowhatodo/">Hussam</a>, we discovered and exploited this flow.</p>

<h2>Introduction</h2>

<p>In the realm of application security, authentication mechanisms play a pivotal role in safeguarding user data. Leveraging robust authentication services like Auth0 can significantly enhance security. However, misconfigurations within these services can introduce critical vulnerabilities. In this article, we delve into a recent discovery of a severe vulnerability related to Auth0 misconfiguration in an application we were testing. This write-up aims to shed light on the issue, the steps taken to identify and exploit it.</p>

<h2>Background: Understanding Auth0 and Social Logins</h2>

<p>Auth0 is a widely used authentication and authorization platform that simplifies the implementation of secure login systems. It supports various authentication methods, including social logins like Google, Facebook, and others. Social logins offer users the convenience of signing up and logging in using their existing social media accounts, reducing the friction of creating new credentials.</p>

<p>However, the integration of social logins requires meticulous configuration to ensure that user data is handled securely. Misconfigurations can lead to vulnerabilities such as account linking issues, where multiple accounts inadvertently reference the same user data.</p>

<h2>The Application Under Test</h2>

<p>The application in question limited user registration exclusively to Google accounts through the “Signup with Google” option. This singular authentication pathway streamlined the user experience but also concentrated the authentication process within a single framework — Auth0.</p>

<h2>Discovery of the Vulnerability</h2>

<p>During testing, we identified a significant vulnerability stemming from a misconfiguration in Auth0. The application exhibited unintended behavior when users attempted to create accounts using the same email address through different authentication methods. Specifically, creating an account via Google and then attempting to register with the same email using email and password led to unexpected account linking or data retrieval issues.</p>

<h2>Reasons Behind the Vulnerability</h2>

<p>There are two primary reasons for this behavior:</p>

<h3>1. User Data Retrieval Based on Email:</h3>

<ul>
    <li>The application fetches user data based on the email present in the <code style="background-color: gray;">Access_token</code> or <code style="background-color: gray;">Id_token</code>. Consequently, when a user attempts to create a new account with an existing email, the system retrieves and returns data from the original account.</li>
</ul>

<h3>2. Account Linking</h3>

<ul>
    <li><strong>Developer Misconfiguration</strong><br> The unintended account linking occurs due to misconfigurations made by the developers within the Auth0 setup. Specifically, when a user attempts to register multiple accounts using the same email address through different authentication methods (e.g., signing up with Google and then with email and password), the system erroneously links these accounts as one. This linkage happens because the developers did not implement the necessary safeguards or utilize the appropriate tools to manage account associations correctly.</li>

    <li><strong>Auth0 Extension for Account Linking</strong><br> Auth0 provides an <strong>Account Linking</strong> extension designed to handle the association of multiple authentication methods to a single user profile securely. This extension ensures that account linking is performed intentionally and securely, preventing accidental or unauthorized linking of user accounts. By leveraging this extension, developers can manage how and when accounts are linked, thereby mitigating the risk of data conflicts and enhancing the overall security of the authentication system.</li>
</ul>
<h2><strong>Detailed Steps to Identify and Exploit the Vulnerability</strong></h2>

<h3>Step 1: Account Creation via Social Login</h3>

<p>We began by creating an account using the available “Signup with Google” option. This established the initial user profile within the application’s authentication system.</p>

<h3>Step 2: Attempting Email and Password Registration</h3>

<p>Next, we attempted to create a new account using the same email address (<code style="background-color: gray;">testacc2399@gmail.com</code>) and a password (<code style="background-color: gray;">testA@123</code>) through the public sign-up endpoint associated with Auth0. However, we encountered an issue where the <code style="background-color: gray;">dbconnection</code> parameter was either incorrect or not linked to the application, preventing successful account creation.</p>

<h3>Step 3: Exploiting Misconfiguration to Identify dbconnection</h3>

<p>To bypass the misconfiguration, I employed a technique to identify the correct <code style="background-color: gray;">dbconnection</code> tied to the application under test. Once I obtained the <code style="background-color: gray;">dbconnection</code> name, we crafted a specific HTTP POST request using Burp Suite:</p>

<pre><code class="language-javascript">POST /dbconnections/signup HTTP/2
Host: auth.test.ai
Content-Length: 224
Content-Type: application/json
Origin: https://auth.test.ai
Referer: https://auth.test.ai/

{
  "client_id": "XXXXXXXXXXXXXXXXXXXX",
  "email": "testacc2399@gmail.com",
  "password": "testA@123",
  "connection": "app-prod-users",
  "credential_type": "http://auth0.com/oauth/grant-type/password-realm"
}
</code></pre>

<p><strong>Important Note:</strong> For the request to be successful, both the <code style="background-color: gray;">Host</code> and <code style="background-color: gray;">client_id</code> must be accurate.</p>

<h3>Step 4: Creating the Second Account</h3>

<p>Using the identified <code>dbconnection</code>, we submitted the above request. The application accepted the request, creating a new account associated with the same email (<code>testacc2399@gmail.com</code>). This indicated that the system allowed multiple accounts with the same email across different authentication methods, leading to potential data conflicts.</p>

<h3>Step 5: Verifying Account Linking</h3>

<p>To confirm whether the two accounts were linked or if the system fetched data based on the email, we performed the following actions:</p>

<ul>
  <li><strong>Accessing the Account via Email and Password:</strong></li>
  <li><strong>Initial Challenge:</strong> Initially, we faced a challenge: the application did not provide a direct page or interface to log in using email and password. The only available option was to log in via Google.</li>
  <li><strong>Overcoming the Challenge:</strong> To overcome this, we manipulated the authorization endpoint URL to force the authentication method to email and password: <br><code style="background-color: firebrick;">https://{auth.app.xx}/authorize?client_id={Clientid}&amp;response_type=token&amp;connection={dbconnection}&amp;prompt=login&amp;scope=openid%20profile%20phone&amp;redirect_uri={redirect-uri}</code><br></li>
</ul>
<img src="/auth0-1.png" ></a>
<ul>
<li><strong>Result:</strong> Accessing this modified URL prompted a login page where we could enter the email and password. Upon submission, the login redirected us to the original account created via Google, confirming that the system recognized both authentication methods as a single user profile.</li>
</ul>

<h2>Conclusion</h2>

<p>The case study on Auth0 misconfiguration and account linking vulnerabilities emphasizes the risks introduced by improper setup of authentication services. Despite using a robust platform like Auth0, misconfigurations in handling social logins and multiple authentication methods can result in unintended account linking, allowing unauthorized access to user data.</p>
<br>
<p><strong>I hope you enjoyed reading, Thanks.</strong></p>



</div>    

    <footer class="footer">
  <section class="container">
    ©
    
    2022
     Kareem ALsadeq 
    ·
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

  </main>

  
  
  <script src="/js/coder.min.95c87ce84e6a12567a7de2ec1bf4cd9bd1affff21ebbba9398b7130116893991.js" integrity="sha256-lch86E5qElZ6feLsG/TNm9Gv//Ieu7qTmLcTARaJOZE="></script>
  

  

  

  <script>
(function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
})(document, window, '//cdn.usefathom.com/tracker.js', 'fathom');
fathom('set', 'siteId', 'ABCDE');
fathom('trackPageview');
</script>


  <script async defer data-domain="alsadeq.github.io" src="https://plausible.io/js/plausible.js"></script>


  <script data-goatcounter="https://55555.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>


  

  <script type="application/javascript">
  var _paq = window._paq = window._paq || [];
   
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://kareemelsadek.github.io/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', 'ABCDE']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>


  
<script async src="https://www.googletagmanager.com/gtag/js?id=gid"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'gid');
</script>


  <script type="text/javascript">
    !function(T,l,y){var S=T.location,k="script",D="connectionString",C="ingestionendpoint",I="disableExceptionTracking",E="ai.device.",b="toLowerCase",w="crossOrigin",N="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"5",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[b](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,u,p,l;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][b]()]=i[1])}if(!e[C]){var r=e.endpointsuffix,o=r?e.location:null;e[C]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[D]||d[D]||"",u=s[C],p=u?u+"/v2/track":d.endpointUrl,(l=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=p,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\./g,"-"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),l.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\"/g,"")+'"',o.properties={endpoint:a},i}(0,0,t,p)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:N,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(N,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(l,p))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(k);n.src=h;var e=y[w];return!e&&""!==e||"undefined"==n[w]||(n[w]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(k)[0].parentNode.appendChild(e)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[I]&&!0!==s[I]){var c="onerror";t(["_"+c]);var u=T[c];T[c]=function(e,t,n,a,i){var r=u&&u(e,t,n,a,i);return!0!==r&&m["_"+c]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);function a(){y.onInit&&y.onInit(n)}(T[t]=n).queue&&0===n.queue.length?(n.queue.push(a),n.trackPageView({})):a()}(window,document,{
    src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js", 
    
    
    
    crossOrigin: "anonymous", 
    
    cfg: { 
        connectionString: "connectionstring"
         
    }});
    </script>    

<script type="text/javascript">
    let whoami = document.querySelector(".navigation-title h3");
    let textContent = whoami.textContent;
    whoami.textContent = "";
    let i = 0;
    let addLetters = setInterval(() =>{
      whoami.textContent += textContent[i];
      i++;
      i == textContent.length ? clearInterval(addLetters) : "";
    },300)
  </script>
</body>

</html>




